(this.webpackJsonpshebna_mathew_assignment5=this.webpackJsonpshebna_mathew_assignment5||[]).push([[0],{28:function(e,t,a){},36:function(e,t,a){"use strict";a.r(t);var n=a(2),c=a.n(n),s=a(13),r=a.n(s),l=(a(27),a(28),a(5)),o=a(4),i=a(12),d=a(21),u="logged in",j="invalid login",b="network error",h={loginState:"logged out",user:-1,threads:"",threadIds:[],tags:"",viewOnly:!0},O="LOGIN_SUCCESS",g="INVALID_LOGIN",m="LOGIN_NETWORK_ERROR",p="LOGOUT",f="VIEW_ONLY",x="STORE_THREADS",v="STORE_THREAD_IDS",y="STORE_TAGS",N="UPDATE_TAGS",w="ADD_REPLY",I="ADD_POST",S=Object(i.c)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(o.a)(Object(o.a)({},e),{},{loginState:u,user:t.payload.user,viewOnly:t.payload.viewOnly});case g:return Object(o.a)(Object(o.a)({},e),{},{loginState:j});case m:return Object(o.a)(Object(o.a)({},e),{},{loginState:b});case f:return Object(o.a)(Object(o.a)({},e),{},{viewOnly:t.payload.viewOnly});case x:return Object(o.a)(Object(o.a)({},e),{},{threads:t.payload.threads});case v:return Object(o.a)(Object(o.a)({},e),{},{threadIds:t.payload.threadIds});case y:return Object(o.a)(Object(o.a)({},e),{},{tags:t.payload.tags});case N:var a=Object(o.a)({},e.tags);return t.payload.tagId in a?a[t.payload.tagId].threadIds.push(t.payload.postId):a[t.payload.tagId]={tag:t.payload.tag,threadIds:[t.payload.postId]},Object(o.a)(Object(o.a)({},e),{},{tags:a});case I:var n=Object(o.a)({},e.threads);return n[t.payload.postId]=t.payload.post,Object(o.a)(Object(o.a)({},e),{},{threads:n});case w:var c=Object(o.a)({},e.threads),s=c[t.payload.threadId];return s.replies.push(t.payload.reply),Object(o.a)(Object(o.a)({},e),{},{threads:c});case p:return h;default:return e}}),Object(i.a)(d.a)),C=a(7),T=a(19);a(37);T.a.initializeApp({apiKey:"AIzaSyCtD0j_TgV_eCP5tZ0endA9mbqRn1n8I7M",authDomain:"assignment5-4aee9.firebaseapp.com",projectId:"assignment5-4aee9",storageBucket:"assignment5-4aee9.appspot.com",messagingSenderId:"966965517465",appId:"1:966965517465:web:cb6b9a4a56d016f8346c08"});var k=T.a,P=k.firestore(),E=function(e){return{type:f,payload:{viewOnly:e}}},_=function(e){return{type:x,payload:{threads:e}}},D=function(e){return{type:v,payload:{threadIds:e}}},A=function(e,t,a){return{type:N,payload:{tagId:e,postId:t,tag:a}}},F=function(e,t){return function(a){P.collection("users").where("username","==",e).where("password","==",t).get().then((function(e){if(1===e.size){var t=e.docs[0];a((n=t.data(),{type:O,payload:{viewOnly:!1,user:n}}))}else a({type:g});var n})).catch((function(e){console.log("Error logging in.",e)}))}},L=function(){return function(e){P.collection("tags").get().then((function(t){if(t.size>0){var a={};t.forEach((function(e){a[e.id]={tag:e.data().tag,threadIds:e.data().threadIds}})),e(function(e){return{type:y,payload:{tags:e}}}(a))}else console.log("No tags available.")})).catch((function(e){console.log("Error fetching tags.",e)}))}},R=function(e,t){return function(a){P.collection("threads").doc(t).update({replies:k.firestore.FieldValue.arrayUnion(e)}).then((function(){a(function(e,t){return{type:w,payload:{threadId:e,reply:t}}}(t,e))})).catch((function(e){console.log("Could not add the reply.",e)}))}},U=function(e,t,a){return function(a){var n=P.collection("threads").doc();n.set(e).then((function(){a(function(e,t){return{type:I,payload:{postId:e,post:t}}}(n.id,e)),(0!==e.tags.length||1===e.tags.length&&""!==e.tags[0])&&a(function(e,t,a){return function(n){var c,s=[],r=[];for(var l in a)s.push(a[l].tag),r.push(l);t.forEach((function(t){if(s.includes(t)){var a=s.indexOf(t);P.collection("tags").doc(r[a]).update({threadIds:k.firestore.FieldValue.arrayUnion(e)}).then((function(){c=r[a],n(A(c,e,t))})).catch((function(e){console.log("Could not add to the existing tag.",e)}))}else{var l=P.collection("tags").doc();l.set({tag:t,threadIds:[e]}).then((function(){c=l.id,n(A(c,e,t))})).catch((function(e){console.log("Could not add the new tag")}))}}))}}(n.id,e.tags,t))})).catch((function(e){console.log("Could not add the post.",e)}))}},G=a(1),z=function(e){var t=Object(l.c)((function(e){return e.user})),a=Object(n.useState)(""),c=Object(C.a)(a,2),s=c[0],r=c[1],o=Object(l.b)(),i=new Date,d=function(){r("")};return Object(G.jsxs)("div",{class:"list-group",children:[Object(G.jsxs)("a",{href:"#home",class:"list-group-item list-group-item-action post",children:[Object(G.jsxs)("div",{class:"d-flex w-100 justify-content-between",children:[Object(G.jsx)("h5",{class:"mb-1",children:e.post.title}),Object(G.jsx)("small",{class:"text-muted",children:e.post.date})]}),Object(G.jsx)("p",{class:"mb-1",children:e.post.message}),Object(G.jsx)("p",{class:"mb-1",children:e.post.tags}),Object(G.jsx)("small",{class:"text-muted",children:e.post.author})]}),e.content.map((function(e){return Object(G.jsxs)("a",{href:"#home",class:"list-group-item list-group-item-action",children:[Object(G.jsxs)("div",{class:"d-flex w-100 justify-content-between",children:[Object(G.jsx)("h6",{class:"mb-1 user",children:e.author}),Object(G.jsx)("small",{class:"text-muted",children:e.date})]}),Object(G.jsx)("p",{class:"mb-1",children:e.message})]})})),e.loggedIn?Object(G.jsxs)("div",{class:"input-group mb-3",children:[Object(G.jsx)("input",{type:"text",class:"form-control",placeholder:"Add a reply","aria-label":"Add a reply","aria-describedby":"button-addon2",value:s,onChange:function(e){return t=e.target.value,void r(t);var t}}),Object(G.jsx)("button",{class:"btn btn-secondary",type:"button",id:"button-addon2",onClick:function(){0!==s.length&&(o(R({message:s,date:i.toDateString().slice(0,-4),author:t.firstName+" "+t.lastName},e.id)),d())},children:"Submit"})]}):""]})},V=function(e){Object(l.c)((function(e){return e.threads}));var t=Object(l.c)((function(e){return e.tags})),a=Object(l.c)((function(e){return e.user})),c=Object(n.useState)(""),s=Object(C.a)(c,2),r=s[0],o=s[1],i=Object(n.useState)(""),d=Object(C.a)(i,2),u=d[0],j=d[1],b=Object(n.useState)(""),h=Object(C.a)(b,2),O=h[0],g=h[1],m=Object(n.useState)(!1),p=Object(C.a)(m,2),f=p[0],x=p[1],v=Object(l.b)(),y=new Date,N=function(){o(""),j(""),x(!0)};return Object(G.jsxs)("div",{className:"container",children:[Object(G.jsx)("h3",{children:"Add a new post"}),f?Object(G.jsx)("div",{className:"alert alert-danger",role:"alert",children:"Please input a Title"}):"",Object(G.jsxs)("div",{className:"row my-2",children:[Object(G.jsx)("label",{className:"col-sm-3 col-form-label",htmlFor:"selectCategory",children:"Title:"}),Object(G.jsx)("div",{className:"col-sm-9",children:Object(G.jsx)("input",{type:"text",class:"form-control",placeholder:"Title","aria-label":"Title","aria-describedby":"basic-addon1",onChange:function(e){return t=e.target.value,o(t),void x(!1);var t}})})]}),Object(G.jsxs)("div",{className:"row my-2",children:[Object(G.jsx)("label",{className:"col-sm-3 col-form-label",htmlFor:"comment",children:"Message:"}),Object(G.jsx)("div",{className:"col-sm-9",children:Object(G.jsx)("textarea",{className:"form-control",id:"comment",value:u,onChange:function(e){return t=e.target.value,void j(t);var t}})})]}),Object(G.jsxs)("div",{className:"row my-2",children:[Object(G.jsx)("label",{className:"col-sm-3 col-form-label",htmlFor:"selectCategory",children:"Tags:"}),Object(G.jsx)("div",{className:"col-sm-9",children:Object(G.jsx)("input",{type:"text",class:"form-control",placeholder:"Tags (Every tag starts with a # and multiple tags can be separated by whitespace)","aria-label":"Tags","aria-describedby":"basic-addon1",onChange:function(e){return t=e.target.value,void g(t.split(/\s+/));var t}})})]}),Object(G.jsx)("div",{className:"my-2",children:Object(G.jsxs)("div",{className:"text-end",children:[Object(G.jsx)("button",{className:"btn btn-primary",onClick:function(){0===r.length?x(!0):(v(U({title:r,message:u,tags:O,date:y.toDateString().slice(0,-4),author:a.firstName+" "+a.lastName,replies:[]},t)),e.updatePost(!1),N())},children:"Submit"}),Object(G.jsx)("button",{className:"btn btn-light",onClick:function(t){return e.updatePost(!1)},children:"Cancel"})]})})]})},H=function(e){var t=Object(l.c)((function(e){return e.threads})),a=Object(l.c)((function(e){return e.threadIds})),c=Object(n.useState)(""),s=Object(C.a)(c,2),r=s[0],o=s[1],i=Object(n.useState)(""),d=Object(C.a)(i,2),u=d[0],j=d[1],b=Object(n.useState)(""),h=Object(C.a)(b,2),O=h[0],g=h[1],m=Object.keys(t);return Object(G.jsx)("div",{id:"posts",children:Object(G.jsxs)("div",{class:"grid-container listing",children:[Object(G.jsx)("div",{class:"grid-child list-group",children:m.map((function(e,n){return 0===a.length||a.length>0&&a.includes(e)?Object(G.jsxs)("button",{type:"button",class:"list-group-item list-group-item-action","aria-current":0===n?"true":"false",id:n,onClick:function(a){return function(e){o(t[e]),j(t[e].replies),g(e)}(e)},children:[Object(G.jsxs)("div",{class:"d-flex w-100 justify-content-between",children:[Object(G.jsx)("h5",{class:"mb-1",children:t[e].title}),Object(G.jsx)("small",{children:t[e].date})]}),Object(G.jsx)("p",{class:"mb-1",children:t[e].message.slice(0,120)}),Object(G.jsx)("small",{children:t[e].author})]}):""}),t)}),Object(G.jsx)("div",{class:"grid-child",children:e.newPost?Object(G.jsx)(V,{newPost:e.newPost,updatePost:e.updatePost}):u?Object(G.jsx)(z,{post:r,content:u,id:O,loggedIn:e.loggedIn}):""})]})})},K=!1,B=function(){var e=Object(l.c)((function(e){return e.loginState})),t=Object(n.useState)(""),a=Object(C.a)(t,2),c=a[0],s=a[1],r=Object(n.useState)(""),o=Object(C.a)(r,2),i=o[0],d=o[1],u=Object(l.b)(),h=function(){u(F(c,i)),g()},O=function(e){13===e.keyCode&&(e.preventDefault(),h())},g=function(){K=!1,s(""),d("")};return Object(G.jsx)(G.Fragment,{children:Object(G.jsx)("div",{className:"log-in",children:Object(G.jsxs)("div",{className:"container main my-4",children:[!K&&e===j&&Object(G.jsx)("div",{className:"alert alert-danger",children:"Invalid username / password! Please try again."}),!K&&e===b&&Object(G.jsx)("div",{className:"alert alert-danger",children:"Unable to connect to the server. Please check your internet connection."}),Object(G.jsx)("h2",{className:"text-center jobs-font",children:"The Hogwarts Gazette"}),Object(G.jsxs)("div",{className:"row my-4 add-form",children:[Object(G.jsx)("div",{className:"col-12 col-sm-3",children:Object(G.jsx)("label",{htmlFor:"username",className:"form-label",children:"Username:"})}),Object(G.jsx)("div",{className:"col",children:Object(G.jsx)("input",{type:"text",id:"username",name:"username",className:"form-control",value:c,onChange:function(e){K=!0,s(e.target.value)},onKeyUp:function(e){return O(e)}})})]}),Object(G.jsxs)("div",{className:"row my-4 add-form",children:[Object(G.jsx)("div",{className:"col-12 col-sm-3",children:Object(G.jsx)("label",{htmlFor:"password",className:"form-label",children:"Password:"})}),Object(G.jsx)("div",{className:"col",children:Object(G.jsx)("input",{type:"password",id:"password",name:"password",className:"form-control",value:i,onChange:function(e){K=!0,d(e.target.value)},onKeyUp:function(e){return O(e)}})})]}),Object(G.jsx)("div",{className:"row",children:Object(G.jsx)("div",{className:"col text-center",children:Object(G.jsx)("button",{type:"button",className:"btn btn-secondary float-end",onClick:h,children:"Log in"})})}),Object(G.jsx)("button",{type:"button",class:"btn unsigned",onClick:function(e){return u(E(!0))},children:"Continue without signing in"})]})})})},M=function(){var e=Object(l.c)((function(e){return e.user})),t=Object(l.c)((function(e){return e.loginState})),a=Object(l.c)((function(e){return e.viewOnly})),c=Object(l.c)((function(e){return e.tags})),s=Object(l.c)((function(e){return e.threads})),r=Object(n.useState)(!1),o=Object(C.a)(r,2),i=o[0],d=o[1],j=Object.keys(c),b=Object(l.b)();console.log("home tags: ",c),s===h.threads&&b((function(e){P.collection("threads").get().then((function(t){if(t.size>0){var a={};t.forEach((function(e){a[e.id]={title:e.data().title,message:e.data().message,tags:e.data().tags,date:e.data().date,author:e.data().author,replies:e.data().replies}})),e(_(a))}else console.log("No threads available.")})).catch((function(e){console.log("Error fetching threads.",e)}))})),c===h.tags&&b(L());return a||t===u?Object(G.jsxs)("div",{id:"home",children:[Object(G.jsx)("nav",{className:"navbar navbar-dark",children:Object(G.jsxs)("div",{className:"container-fluid",children:[Object(G.jsx)("label",{class:"d-flex name",children:a?"":e.firstName}),Object(G.jsx)("a",{className:"navbar-brand mx-auto font title",href:"#home",onClick:function(){b(D([]))},children:"The Hogwarts Gazette"}),Object(G.jsx)("form",{class:"d-flex",children:Object(G.jsx)("button",{type:"button",class:"btn btn-outline-light",onClick:function(){b(t===u?{type:p}:E(!1))},children:t!==u?"Login":"Logout"})})]})}),Object(G.jsxs)("ul",{class:"nav",children:[t===u?Object(G.jsx)("li",{class:"nav-item",children:Object(G.jsx)("button",{type:"button",className:"nav-link active option action","aria-current":"page",value:"New Post",onClick:function(e){return d(!0)},children:"New Post"})}):"",Object(G.jsx)("li",{class:"nav-item",children:Object(G.jsx)("a",{className:"nav-link tag",href:"#home",children:"tags:"})}),j.map((function(e){return Object(G.jsx)("li",{class:"nav-item",children:Object(G.jsx)("button",{type:"button",className:"nav-link active option","aria-current":"page",value:c[e].tag,onClick:function(t){return function(e){var t=c[e].threadIds,a=[];t.forEach((function(e){a.push(e)})),console.log("threads by tag: ",a),b(D(a))}(e)},children:c[e].tag})})}),c)]}),Object(G.jsx)(H,{newPost:i,updatePost:d,loggedIn:t===u})]}):Object(G.jsx)(B,{})},J=function(){return Object(G.jsx)(G.Fragment,{children:Object(G.jsx)(l.a,{store:S,children:Object(G.jsx)(M,{})})})},W=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,38)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;a(e),n(e),c(e),s(e),r(e)}))};r.a.render(Object(G.jsx)(c.a.StrictMode,{children:Object(G.jsx)(J,{})}),document.getElementById("root")),W()}},[[36,1,2]]]);
//# sourceMappingURL=main.cccbd6bc.chunk.js.map